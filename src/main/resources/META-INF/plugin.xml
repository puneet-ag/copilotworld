<idea-plugin>
    <id>com.dpworld.copilotworld</id>
    <name>AVATAR</name>
    <vendor email="test@gmail.com" url="">Puneet Agarwal</vendor>
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.lang</depends>
    <depends optional="true" config-file="plugin-java.xml">com.intellij.modules.java</depends>

    <projectListeners>
        <listener topic="com.intellij.codeInsight.lookup.LookupManagerListener"
                  class="com.dpworld.copilotworld.listener.MethodNameLookupListener"/>
        <listener topic="com.intellij.openapi.wm.ex.ToolWindowManagerListener"
                  class="com.dpworld.copilotworld.listener.ChatToolWindowListener"/>
    </projectListeners>

    <extensions defaultExtensionNs="com.intellij">
        <postStartupActivity implementation="com.dpworld.copilotworld.panel.AvatarProjectActivity"/>
        <postStartupActivity implementation="com.dpworld.copilotworld.avatar.AvatarUpdateActivity"/>
        <applicationConfigurable id="settings.avatar" parentId="tools" displayName="Avatar"
                                 instance="com.dpworld.copilotworld.configurations.GeneralSettingsConfigurable"/>
        <applicationConfigurable id="settings.avatar.services.ollama" parentId="settings.avatar" displayName="Model Server"
                                 instance="com.dpworld.copilotworld.ollama.OllamaSettingsConfigurable"/>

        <applicationService serviceImplementation="com.dpworld.copilotworld.configurations.GeneralSettings"/>
        <applicationService serviceImplementation="com.dpworld.copilotworld.ollama.OllamaSettings"/>
        <applicationService serviceImplementation="com.dpworld.copilotworld.configuration.ConfigurationSettings"/>
        <applicationService serviceImplementation="com.dpworld.copilotworld.advanced.AdvancedSettings"/>
        <applicationService serviceImplementation="com.dpworld.copilotworld.conversation.ConversationsState"/>
        <applicationService serviceImplementation="com.dpworld.copilotworld.configurations.IncludedFilesSettings"/>

        <inline.completion.provider
                id="AvatarInlineCompletionProvider"
                implementation="com.dpworld.copilotworld.panel.AvatarInlineCompletionProvider"/>
        <toolWindow id="Avatar" icon="com.dpworld.copilotworld.panel.Icons.DefaultSmall" anchor="right"
                    factoryClass="com.dpworld.copilotworld.panel.ProjectToolWindowFactory"/>
        <notificationGroup id="Avatar Notification Group" displayType="BALLOON" key="notification.group.name"/>
        <notificationGroup id="Avatar Notification Group Sticky" displayType="STICKY_BALLOON" key="notification.group.sticky.name"/>
        <statusBarWidgetFactory order="first" id="com.dpworld.copilotworld.panel.converted.statusbar.widget"
                                implementation="com.dpworld.copilotworld.avatar.AvatarStatusBarWidgetFactory"/>
    </extensions>

    <resource-bundle>messages.copilot</resource-bundle>

    <actions>
        <group id="AvatarEditorPopup">
            <group id="action.editor.group.EditorActionGroup"
                   text="Avatar"
                   class="com.intellij.openapi.actionSystem.DefaultActionGroup"
                   popup="true"
                   icon="com.dpworld.copilotworld.panel.Icons.DefaultSmall">
            </group>
            <add-to-group group-id="EditorPopupMenu1" anchor="first"/>
            <separator/>
        </group>
        <action id="Avatar.TriggerEditorPopup"
                class="com.dpworld.copilotworld.actions.ShowEditorActionGroupAction"
                text="Show Avatar Actions">
            <keyboard-shortcut first-keystroke="ctrl shift alt m" keymap="$default"/>
        </action>
        <group id="Avatar.ProjectViewPopupMenuRootGroup">
            <group id="Avatar.ProjectViewPopupMenuGroup"
                   text="Avatar"
                   class="com.intellij.openapi.actionSystem.DefaultActionGroup"
                   popup="true"
                   icon="com.dpworld.copilotworld.panel.Icons.DefaultSmall">
                <action
                        id="Avatar.IncludeFilesInContextAction"
                        class="com.dpworld.copilotworld.actions.IncludeFilesInContextAction" />
            </group>
            <add-to-group
                    group-id="ProjectViewPopupMenu"
                    relative-to-action="ProjectViewPopupMenuRefactoringGroup"
                    anchor="before"/>
            <separator/>
        </group>

        <action
                id="avatar.openSettings"
                text="Open Settings"
                class="com.dpworld.copilotworld.actions.OpenSettingsAction">
            <override-text place="MainMenu" text="Open Settings"/>
            <override-text place="popup" use-text-of-place="MainMenu"/>
        </action>
        <action
                id="statusbar.enableCompletions"
                class="com.dpworld.copilotworld.actions.EnableCompletionsAction">
            <keyboard-shortcut first-keystroke="ctrl shift alt c" keymap="$default"/>

            <override-text place="MainMenu"/>
            <override-text place="popup" use-text-of-place="MainMenu"/>
        </action>
        <action
                id="statusbar.disableCompletions"
                class="com.dpworld.copilotworld.actions.DisableCompletionsAction">
            <keyboard-shortcut first-keystroke="ctrl shift alt c" keymap="$default"/>

            <override-text place="MainMenu"/>
            <override-text place="popup" use-text-of-place="MainMenu"/>
        </action>

        <group id="avatar.statusBarPopup">
            <reference id="avatar.openSettings" />
            <separator/>

            <reference id="statusbar.disableCompletions" />
            <reference id="statusbar.enableCompletions" />
        </group>

    </actions>
</idea-plugin>
